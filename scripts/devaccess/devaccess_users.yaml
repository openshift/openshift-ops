# devaccess_user sample config file: purpose is to have example for local development
# the real data is stored in the private repo, while this may seem like it is in sync with
# the command list in private that might not be always the case, thus changes to this file
# won't appear on deployed systems
---
roles:
- name: ALL
  commands:
    - base: oc get
      types:
        - names:
            - node
            - nodes
          runner: oc_get_generic
          output:
            - json
        - names:
            - pod
            - pods
          runner: oc_get_generic
          namespaces:
            - default
            - logging
            - openshift-infra
        - names:
            - dc
            - deploymentconfig
          runner: oc_get_generic
          namespaces:
            - default
            - openshift-infra
        - names:
            - route
            - routes
          runner: oc_get_generic
          namespaces:
            - default
            - logging
        - names:
            - storageclass
          runner: oc_get_generic
        - names:
            - pvc
          runner: oc_get_generic
          namespaces:
            - all
        - names:
            - ns
            - project
            - projects
            - namespace
            - namespaces
          runner: oc_get_generic
        - names:
            - svc
            - service
            - services
          runner: oc_get_generic
          namespaces:
            - all
        - names:
            - ep
            - endpoints
          runner: oc_get_generic
          namespaces:
            - all
    - base: oc describe
      types:
        - names:
            - clusterresourcequota
          runner: oc_get_generic
        - names:
            - node
            - nodes
          runner: oc_get_generic
    - base: oc logs
      types:
        - names:
            - ignoreme
          runner: oc_get_generic
          namespaces:
            - default
            - openshift-infra
            - logging
    - base: oc version
      types:
        - names:
            - ignoreme
          runner: oc_get_generic
    - base: rpm
      runner: safe_command
      switches:
        - -qa
    - base: cat
      runner: sudo_command
      switches:
        - /proc/cpuinfo
        - /proc/meminfo
        - /proc/vmstat
        - /proc/interrupts
        - /proc/slabinfo
        - /proc/cmdline
        - /etc/origin/node/node-config.yaml
        - /etc/etcd/etcd.conf
    - base: ethtool
      runner: safe_command
      switches:
        - -i
      leftover:
        - '^eth[0-9]$'
        - '^enp[0-9]s[0-9]$'
    - base: uptime
      runner: safe_command
    - base: lsblk
      runner: safe_command
      switches:
        - -at
        - --output
      leftover:
        - NAME,KNAME,FSTYPE,RA,SIZE,SCHED,TYPE
    - base: lscpu
      runner: safe_command
    - base: uname
      runner: safe_command
      switches:
        - -r
    - base: ps
      runner: safe_command
      switches:
        - auxwww
        - aux
    - base: df
      runner: safe_command
      switches:
        - -h
    - base: iostat
      runner: cmd_with_tail
      switches:
        - -x
        - -y
      leftover:
        - '^[0-9]+$'
    - base: mpstat
      runner: cmd_with_tail
      switches:
        - -P
        - ALL
      leftover:
        - '^[0-9]+ [0-9]+$'
    - base: vmstat
      runner: cmd_with_tail
      switches:
        - -w
      leftover:
        - '^[0-9]+ [0-9]+$'
    - base: ss
      runner: safe_command
      switches:
      - -peaonmi
    - base: hostname
      runner: safe_command
    - base: date
      runner: safe_command
    - base: dmidecode
      runner: safe_command
    - base: sysctl
      runner: safe_command
      switches:
        - -a
    - base: tuned-adm
      runner: safe_command
      switches:
        - list
    - base: ip
      runner: safe_command
      switches:
        - a
        - neigh
        - show
    - base: free
      runner: safe_command
      switches:
      - -m
    - base: docker
      runner: sudo_command
      switches:
        - version
        - info
        - ps
        - -a
        - stats
        - --no-stream
    - base: pstree
      runner: safe_command
    - base: pidstat
      runner: safe_command
      switches:
        - -l
        - -w
        - -u
        - -d
        - -r
        - -t
        - -h
        - -p
        - ALL
    - base: systemctl
      runner: safe_command
      switches:
        - status
        - -al
        - --no-pager
    - base: systemd-cgls
      runner: safe_command
    - base: systemctl
      runner: safe_command
      switches:
      - status
      - atomic-openshift-master-api
      - atomic-openshift-master-controllers
      - atomic-openshift-node
      - docker
      - etcd
      - ovs-vswitchd
      - ovsdb-server
      - NetworkManager
      - dnsmasq
    - base: etcdctlx
      runner: script_command
      switches:
        - member
        - list
        - alarm
        - endpoint
        - health
        - status
        - version
    - base: curl
      runner: safe_command
      switches:
        - -s
        - http://169.254.169.254/latest/meta-data/instance-id
        - http://169.254.169.254/latest/meta-data/instance-type
    - base: journalctl
      runner: sudo_command
      switches:
      - -u
      - atomic-openshift-node
      - atomic-openshift-master-api
      - atomic-openshift-master-controllers
      - docker
      - etcd
      - ovs-vswitchd
      - ovsdb-server
      - NetworkManager
      - dnsmasq
      - --since
      - --until
      - -1h
      - -2h
      - -3h
      - -6h
      - -12h
      - -24h
      - today
      - yesterday
      defaultparams:
      - --no-pager
    - base: ping
      runner: cmd_with_tail
      leftover:
      - ^[a-zA-Z0-9.-]+$
      defaultparams:
      - -c 5
    - base: iptables-save
      runner: sudo_command
    - base: iptables
      runner: sudo_command
      switches:
        - -nvL
        - -t
        - nat
      leftover:
        - ^(?!-)[_a-zA-Z0-9-]*$
    - base: ovs-ofctl
      runner: sudo_command
      switches:
        - dump-flows
        - br0
        - -O
        - OpenFlow13
    - base: redacted.py
      runner: script_command
      switches:
        - master-config

- name: nobody_role
  commands:
    - base: uname
      runner: safe_command

- name: NETWORK
  commands:
    - base: curl
      runner: safe_command
      leftover:
        - ^[a-zA-Z0-9._-/]*$

users:
- username: user1
- username: user2
- username: user3


user_roles:
  - username: user1
    roles:
      - NETWORK
  - username: user2
    roles:
      - STUFF

# I know this doesn't seem to make sense, to separate these two structure, sadly
# our config management gets the users and the roles from separate sources, changing
# it here was easier for now, than rearchitecting the other end
